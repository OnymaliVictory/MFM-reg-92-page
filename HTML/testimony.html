<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MFM — Testimonies</title>
  <link rel="stylesheet" href="/CSS/style.css">
  <link rel="stylesheet" href="/CSS/testimony.css">
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <header class="header">
      <a href="index.html" class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24">
             <img src="/IMG/mfmlogoman3.png" style="margin:6px; width:60px;" alt="">
          </svg>
        </div>
        <div class="brand-text">
          <h1>MFM Mid-West Reg.92 Sapele Delta State.</h1>
          <p>Deliverance • Worship • Miracles</p>
        </div>
      </a>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="bible.html">Bible</a>
      <a href="hymn.html">Hymns</a>
        <a href="testimony.html">Testimonies</a>
        <a href="prayer_book.html">Prayer Book</a>
        <a href="admin_login.html" class="btn btn-ghost">Admin</a>
        <button class="btn btn-primary">Donate</button>
      </nav>

      <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    </header>

    <!-- HERO -->
    <section class="hero" style="padding:50px 20px;">
      <div class="hero-left" style="width:100%;">
        <h2 style="font-size:2.2rem;">Testimonies of God's Power</h2>
        <p style="max-width:700px; margin-top:10px;">
          Share your testimony and inspire thousands. You can also choose to submit anonymously.
        </p>
      </div>
      
    </section>

<!-- RECENT TESTIMONIES -->
<main style="padding: 40px 0;">
  <section>
    <h3>Recent Testimonies</h3>
    <div id="recentTestimonyList" class="ann-list">
      <p>Loading recent testimonies…</p>
    </div>
  </section>

  <section style="margin-top:40px;">
    <h2>All Testimonies</h2>
    <div id="testimonyContainer">
      <p>Loading testimonies…</p>
    </div>
  </section>
</main>

      </section>

      <!-- SHARE TESTIMONY BUTTON -->
      <div class="card" style="max-width:500px; margin:auto; text-align:center; margin-top:40px;">
        <h3>Share Your Testimony</h3>
        <p class="meta">Your story can inspire thousands. Submit your testimony today.</p>
        <button id="shareTestimonyBtn" class="btn-primary" style="margin-top:10px;">Submit Testimony</button>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      © <span id="year"></span> MFM Ministries — All rights reserved.
    </footer>

  </div>

  <!-- ================= MODAL ================= -->
  <div id="testimonyModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <form id="testimonyForm">
        <input type="text" id="userName" placeholder="Your Name (Optional)">
<input type="email" id="userEmail" placeholder="Your Email">
<textarea id="userTestimony" placeholder="Your Testimony"></textarea>
<label class="checkbox-wrapper">
  <input type="checkbox" id="anonymous">
  <span class="checkmark"></span>
  Submit Anonymously
</label>

<button type="button" onclick="submitTestimony()" class="btn-submit">Submit Testimony</button>

      </form>
    </div>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script src="/JS/testimony.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<!-- ================= FIREBASE CDN ================= -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script>
// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyDazF8P4J-E6UE8J0ERG3K-6m_p_LAWHfs",
  authDomain: "mfmc-829c0.firebaseapp.com",
  projectId: "mfmc-829c0",
  storageBucket: "mfmc-829c0.firebasestorage.app",
  messagingSenderId: "332488323280",
  appId: "1:332488323280:web:e379be4ba2a496b3a32ed5",
  measurementId: "G-9PTSB7XH82"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================= HEADER MENU =================
function toggleMenu() {
  document.querySelector(".nav").classList.toggle("open");
}
document.getElementById("year").textContent = new Date().getFullYear();

// ================= MODAL HANDLING =================
const shareBtn = document.getElementById("shareTestimonyBtn");
const modal = document.getElementById("testimonyModal");
const closeModalBtn = document.getElementById("closeModal");
const form = document.getElementById("testimonyForm");

shareBtn.addEventListener("click", () => modal.style.display = "block");
closeModalBtn.addEventListener("click", () => modal.style.display = "none");
window.addEventListener("click", e => { if(e.target === modal) modal.style.display = "none"; });

// ================= SUBMIT TESTIMONY (FIRESTORE) =================
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const message = document.getElementById("message").value.trim();
  const anonymous = document.getElementById("anonymous").checked;

  if(!message){
    alert("Please write your testimony before submitting.");
    return;
  }

  const displayName = anonymous || !name ? "Anonymous" : name;

  await db.collection("testimonies").add({
    name: displayName,
    email: anonymous ? "" : email,
    message: message,
    date: Date.now()
  });

  alert("Testimony submitted successfully!");
  form.reset();
  modal.style.display = "none";
});

// ================= DISPLAY TESTIMONIES (REAL-TIME) =================
function loadTestimonies() {
  const container = document.getElementById("testimonyContainer");
  const recent = document.getElementById("recentTestimonyList");

  db.collection("testimonies")
    .orderBy("date", "desc")
    .onSnapshot(snapshot => {
      container.innerHTML = "";
      recent.innerHTML = "";

      if(snapshot.empty){
        container.innerHTML = "<p>No testimonies submitted yet.</p>";
        recent.innerHTML = "<p>No testimonies submitted yet.</p>";
        return;
      }

      let count = 0;

      snapshot.forEach(doc => {
        const t = doc.data();

        const item = `
          <div class="testimony-item">
            <p><strong>${t.name}</strong></p>
            <p>${t.message}</p>
            <small>${new Date(t.date).toLocaleString()}</small>
            <hr>
          </div>
        `;

        container.innerHTML += item;

        if(count < 3){  
          recent.innerHTML += item;  
          count++;
        }
      });
    });
}

document.addEventListener("DOMContentLoaded", loadTestimonies);
</script>
<script src="/JS/firebase.js" type="module"></script>

</body>
</html>
